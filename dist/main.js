var d={id:"bajrangcoder.path.intellize",name:"PathIntellisense",main:"dist/main.js",version:"1.0.0",readme:"readme.md",icon:"icon.png",files:[],minVersionCode:290,price:0,author:{name:"Raunak Raj",email:"bajrangcoders@gmail.com",github:"bajrangCoder"}};var f=class{constructor(){this.cache=new Map,this.accessOrder=[]}async getAsync(e){return this.cache.has(e)?(this.accessOrder=this.accessOrder.filter(t=>t!==e),this.accessOrder.unshift(e),this.cache.get(e)):null}async setAsync(e,t){if(this.cache.size>=20){let s=this.accessOrder.pop();this.cache.delete(s)}this.cache.set(e,t),this.accessOrder.unshift(e)}},p=f;var C=acode.require("fsOperation"),w=acode.require("helpers"),{editor:m}=editorManager,g=class{constructor(){this.directoryCache=new p}async init(){let e=this;m.completers.push({getCompletions:async function(t,s,n,u,a){let i=s.getLine(n.row),o=e.getCurrentInput(i,n.column);if(!editorManager.activeFile.uri)return;let c=e.removeFileNameAndExtension(editorManager.activeFile.uri);if(o.startsWith("/")){let l=c,r=e.resolveRelativePath(l,o);await e.fetchDirectoryContents(r,a,!1)}else if(o.startsWith("../")){let l=c,r=e.resolveRelativePath(l,o);await e.fetchDirectoryContents(r,a,!1)}else if(o.startsWith("./")){let l=c,r=e.resolveRelativePath(l,o.substring(1));await e.fetchDirectoryContents(r,a,!1)}else await e.fetchDirectoryContents(c,a,!0)}}),m.commands.on("afterExec",function(t){t.command.name==="insertstring"&&t.args==="/"&&m.execCommand("startAutocomplete")})}async fetchDirectoryContents(e,t,s){try{let n=await this.directoryCache.getAsync(e);if(n){t(null,n);return}let u=await C(e).lsDir();console.log(u);let a=u.map(function(i){return{caption:i.name,value:i.name,score:s?500:8e3,meta:i.isFile?"File":"Folder",icon:i.isFile?`${w.getIconForFile(i.name)}`:"icon folder"}});console.log(a),await this.directoryCache.setAsync(e,a),t(null,a)}catch(n){t(null,[]),console.log(n)}}getCurrentInput(e,t){let s="",n=t-1;for(;n>=0&&/[a-zA-Z0-9/.+_\-\s]/.test(e[n]);)s=e[n]+s,n--;return s}resolveRelativePath(e,t){if(t.startsWith("/"))return e+t;let s=e.split("::");if(s.length===2){let n=s[0],u=s[1],a=t.split("/"),i=u.split("/").filter(Boolean),o="data/data/com.termux/files/home";for(let r of a)r===".."?i.length>1&&i.join("/")!==o&&i.pop():(r!=="."&&r!==""&&i.join("/")!==o||r!=="."&&r!==""&&r!==".."&&i.join("/")===o)&&i.push(r);let c=i.join("/");return n+"::/"+c+"/"}return e}removeFileNameAndExtension(e){let t=e.lastIndexOf("/"),s=e.substring(t+1);return e.substring(0,e.length-s.length-1)}async destroy(){}};if(window.acode){let h=new g;acode.setPluginInit(d.id,async(e,t,{cacheFileUrl:s,cacheFile:n})=>{e.endsWith("/")||(e+="/"),h.baseUrl=e,await h.init(t,n,s)}),acode.setPluginUnmount(d.id,()=>{h.destroy()})}
