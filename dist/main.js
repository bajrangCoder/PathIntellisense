var d={id:"bajrangcoder.path.intellize",name:"PathIntellisense",main:"dist/main.js",version:"1.0.1",readme:"readme.md",icon:"icon.png",files:[],minVersionCode:290,price:0,author:{name:"Raunak Raj",email:"bajrangcoders@gmail.com",github:"bajrangCoder"}};var f=class{constructor(){this.cache=new Map,this.accessOrder=[]}async getAsync(e){return this.cache.has(e)?(this.accessOrder=this.accessOrder.filter(t=>t!==e),this.accessOrder.unshift(e),this.cache.get(e)):null}async setAsync(e,t){if(this.cache.size>=20){let s=this.accessOrder.pop();this.cache.delete(s)}this.cache.set(e,t),this.accessOrder.unshift(e)}},p=f;var C=acode.require("fsOperation"),v=acode.require("helpers"),{editor:m}=editorManager,g=class{constructor(){this.directoryCache=new p}async init(){let e=this;m.completers.push({getCompletions:async function(t,s,n,o,a){let u=s.getLine(n.row),i=e.getCurrentInput(u,n.column);if(!editorManager.activeFile.uri)return;let r=e.removeFileNameAndExtension(editorManager.activeFile.uri);if(i.startsWith("/")){let c=r,h=e.resolveRelativePath(c,i);await e.fetchDirectoryContents(h,a,!1)}else if(i.startsWith("../")){let c=r,h=e.resolveRelativePath(c,i);await e.fetchDirectoryContents(h,a,!1)}else if(i.startsWith("./")){let c=r,h=e.resolveRelativePath(c,i.substring(1));await e.fetchDirectoryContents(h,a,!1)}else await e.fetchDirectoryContents(r,a,!0)}}),m.commands.on("afterExec",function(t){t.command.name==="insertstring"&&t.args==="/"&&m.execCommand("startAutocomplete")})}async fetchDirectoryContents(e,t,s){try{let n=await this.directoryCache.getAsync(e);if(n){t(null,n);return}let a=(await C(e).lsDir()).map(function(u){let{isFile:i,name:r}=u,c=v.getIconForFile(r);return{caption:r,value:i?r:r+"/",score:s?500:8e3,meta:i?"File":"Folder",icon:i?`${c}`:"icon folder"}});await this.directoryCache.setAsync(e,a),t(null,a)}catch(n){t(null,[]),console.log(n)}}getCurrentInput(e,t){let s="",n=t-1;for(;n>=0&&/[a-zA-Z0-9/.+_\-\s]/.test(e[n]);)s=e[n]+s,n--;return s}resolveRelativePath(e,t){if(t.startsWith("/"))return e+t;let s=e.split("::");if(s.length===2){let n=s[0],o=s[1];o.endsWith("/")||(o+="/");let a=t.split("/");for(let i of a)if(i===".."){let r=o.lastIndexOf("/",o.length-2);r!==-1&&(o=o.substring(0,r+1))}else i!=="."&&i!==""&&(o+=i+"/");return n+"::"+o}return e}removeFileNameAndExtension(e){let t=e.lastIndexOf("/"),s=e.substring(t+1);return e.substring(0,e.length-s.length-1)}async destroy(){}};if(window.acode){let l=new g;acode.setPluginInit(d.id,async(e,t,{cacheFileUrl:s,cacheFile:n})=>{e.endsWith("/")||(e+="/"),l.baseUrl=e,await l.init(t,n,s)}),acode.setPluginUnmount(d.id,()=>{l.destroy()})}
